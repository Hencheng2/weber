<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Web Designer Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;600&family=Montserrat:wght@400;700&family=Lato:wght@400;700&family=Poppins:wght@400;600&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #1e1e1e;
            color: #e0e0e0;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }
        #container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        #top-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #2d2d2d;
            padding: 10px;
            text-align: center;
            z-index: 1000;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        #top-menu button {
            padding: 8px 16px;
            cursor: pointer;
            border: none;
            background-color: #3b82f6;
            color: #ffffff;
            border-radius: 5px;
        }
        #top-menu button:hover {
            background-color: #2563eb;
        }
        #top-menu button.active {
            background-color: #16a34a;
        }
        .dropdown {
            position: absolute;
            top: 100%;
            background-color: #2d2d2d;
            border: 1px solid #444;
            border-radius: 4px;
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        .dropdown ul {
            list-style: none;
            padding: 10px;
            margin: 0;
        }
        .dropdown li {
            padding: 10px;
            background-color: #3c3c3c;
            margin-bottom: 5px;
            cursor: grab;
            border-radius: 4px;
            user-select: none;
        }
        .dropdown li:hover {
            background-color: #4a4a4a;
        }
        #main-content {
            position: fixed;
            top: 60px;
            bottom: 160px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: visible;
        }
        #workspace {
            border: 2px solid #3f3f3f;
            background-color: #252525;
            transition: width 0.3s ease, height 0.3s ease;
            max-width: 100%;
            max-height: 100%;
            overflow: auto;
        }
        #workspace.edit-mode {
            position: relative;
            background-color: #333;
            border: 1px solid #444;
        }
        #workspace.view-mode {
            width: 1366px;
            height: 768px;
        }
        #workspace.view-mode iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: #ffffff;
        }
        #workspace.phone {
            width: 360px;
            height: 640px;
        }
        #workspace.tablet {
            width: 768px;
            height: 1024px;
        }
        #workspace.laptop {
            width: 1366px;
            height: 768px;
        }
        #properties {
            width: 300px;
            background-color: #2d2d2d;
            padding: 20px;
            border-left: 1px solid #444;
            max-height: calc(100vh - 220px);
            overflow-y: auto;
        }
        #properties label {
            display: block;
            margin-bottom: 10px;
        }
        #properties input, #properties select, #properties textarea {
            background-color: #2d2d2d;
            color: #fff;
            border: 1px solid #444;
            width: 100%;
            padding: 5px;
        }
        #code {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background-color: #2d2d2d;
            border-top: 2px solid #3f3f3f;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        #code .textarea-group {
            display: flex;
            gap: 10px;
        }
        #code .textarea-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        #code h3 {
            margin: 0;
            font-size: 12px;
            text-align: center;
            color: #e0e0e0;
        }
        #code textarea {
            width: 100%;
            height: 60px;
            font-family: monospace;
            font-size: 12px;
            padding: 8px;
            border: 1px solid #3f3f3f;
            border-radius: 5px;
            resize: none;
            background-color: #1e1e1e;
            color: #e0e0e0;
        }
        #code textarea::placeholder {
            color: #6b7280;
        }
        #code .button-group {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        #code button {
            padding: 6px 12px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: #ffffff;
            width: 80px;
        }
        #code button.clear {
            background-color: #dc2626;
        }
        #code button.clear:hover {
            background-color: #b91c1c;
        }
        #code button.paste {
            background-color: #16a34a;
        }
        #code button.paste:hover {
            background-color: #15803d;
        }
        #code button.copy {
            background-color: #f59e0b;
        }
        #code button.copy:hover {
            background-color: #d97706;
        }
        #code button.distinguish {
            background-color: #8b5cf6;
        }
        #code button.distinguish:hover {
            background-color: #7c3aed;
        }
        .shape.rectangle, .shape.square, .shape.rounded-rectangle {
            background-color: #007bff;
        }
        .shape.circle, .shape.oval {
            background-color: #dc3545;
            border-radius: 50%;
        }
        .shape.triangle {
            width: 0;
            height: 0;
            border-left: 50px solid transparent;
            border-right: 50px solid transparent;
            border-bottom: 100px solid #28a745;
            background-color: transparent;
        }
        .shape.pentagon, .shape.hexagon, .shape.octagon {
            background-color: #6610f2;
        }
        .icon, .social-icon {
            font-size: 24px;
            display: inline-block;
        }
        .modal {
            background-color: #fff;
            color: #000;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .card {
            background-color: #444;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .slider {
            background-color: #555;
            padding: 10px;
            border-radius: 4px;
        }
        #workspace.edit-mode > * {
            position: absolute;
            resize: both;
            overflow: auto;
        }
        #workspace.view-mode > * {
            position: static;
            resize: none;
            cursor: default;
        }
        #workspace.view-mode > *.selected {
            border: none;
        }
        #page-nav {
            position: fixed;
            top: 60px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 900;
        }
        #page-nav input, #page-nav select, #page-nav button {
            background-color: #3c3c3c;
            border: none;
            color: #fff;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
        }
        #page-nav input:hover, #page-nav select:hover, #page-nav button:hover {
            background-color: #4a4a4a;
        }
        #apply-code-btn {
            background-color: #28a745;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        #apply-code-btn:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="top-menu">
            <button id="edit-mode-btn" class="active" onclick="setMode('edit')">Edit Mode</button>
            <button id="view-mode-btn" onclick="setMode('view')">View Mode</button>
            <button id="phone-btn" onclick="setPreview('phone')" style="display: none;">Phone (360x640)</button>
            <button id="tablet-btn" onclick="setPreview('tablet')" style="display: none;">Tablet (768x1024)</button>
            <button id="laptop-btn" onclick="setPreview('laptop')" style="display: none;">Laptop (1366x768)</button>
            <button id="add-shape-btn" onclick="openCategory('shapes', this)">Add Shape</button>
            <button id="add-icon-btn" onclick="openCategory('icons', this)">Add Icon</button>
            <button id="add-social-icon-btn" onclick="openCategory('social-icons', this)">Add Social Icon</button>
            <button id="add-material-icon-btn" onclick="openCategory('material-icons', this)">Add Material Icon</button>
            <button id="add-navigation-btn" onclick="openCategory('navigations', this)">Add Navigation</button>
            <button id="add-menu-btn" onclick="openCategory('menus', this)">Add Menu</button>
            <button id="add-media-btn" onclick="openCategory('media', this)">Add Media</button>
            <button id="add-form-btn" onclick="openCategory('forms', this)">Add Form</button>
            <button id="add-utility-btn" onclick="openCategory('utilities', this)">Add Utility</button>
            <button id="add-creative-btn" onclick="openCategory('creatives', this)">Add Creative</button>
            <button id="add-modal-btn" onclick="openCategory('modals', this)">Add Modal</button>
            <button id="add-button-btn" onclick="openCategory('buttons', this)">Add Button</button>
            <button id="add-card-btn" onclick="openCategory('cards', this)">Add Card</button>
            <button id="add-slider-btn" onclick="openCategory('sliders', this)">Add Slider</button>
            <button id="add-font-btn" onclick="openCategory('fonts', this)">Add Font</button>
        </div>
        <div id="page-nav">
            <button onclick="newPage()">New Page</button>
            <input id="page-name" type="text" placeholder="Enter page name" value="index.html">
            <select id="page-selector" onchange="switchPage(this.value)">
                <option value="page1" data-name="index.html">index.html</option>
            </select>
            <button id="apply-code-btn" onclick="applyCode()" style="display: none;">Apply Code</button>
        </div>
        <div id="main-content">
            <div id="workspace" class="edit-mode"></div>
            <div id="properties">
                <h3>Properties</h3>
                <div id="prop-content"></div>
                <button id="delete-btn" style="display: none; background-color: #dc3545; border: none; color: white; padding: 10px; cursor: pointer;">Delete Selected</button>
            </div>
        </div>
        <div id="code">
            <div class="textarea-group">
                <div class="textarea-container">
                    <h3>HTML</h3>
                    <textarea id="html" placeholder="Enter your HTML code here..."></textarea>
                    <div class="button-group">
                        <button class="clear" onclick="clearCode('html')">Clear</button>
                        <button class="paste" onclick="pasteCode('html')">Paste</button>
                        <button class="copy" onclick="copyCode('html')">Copy</button>
                        <button class="distinguish" onclick="distinguishCode()">Distinguish</button>
                    </div>
                </div>
                <div class="textarea-container">
                    <h3>CSS</h3>
                    <textarea id="css" placeholder="Enter your CSS code here..."></textarea>
                    <div class="button-group">
                        <button class="clear" onclick="clearCode('css')">Clear</button>
                        <button class="paste" onclick="pasteCode('css')">Paste</button>
                        <button class="copy" onclick="copyCode('css')">Copy</button>
                    </div>
                </div>
                <div class="textarea-container">
                    <h3>JavaScript</h3>
                    <textarea id="js" placeholder="Enter your JavaScript code here...">// No JS generated yet</textarea>
                    <div class="button-group">
                        <button class="clear" onclick="clearCode('js')">Clear</button>
                        <button class="paste" onclick="pasteCode('js')">Paste</button>
                        <button class="copy" onclick="copyCode('js')">Copy</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const workspace = document.getElementById('workspace');
        const htmlArea = document.getElementById('html');
        const cssArea = document.getElementById('css');
        const jsArea = document.getElementById('js');
        const propContent = document.getElementById('prop-content');
        const deleteBtn = document.getElementById('delete-btn');
        const editModeBtn = document.getElementById('edit-mode-btn');
        const viewModeBtn = document.getElementById('view-mode-btn');
        const phoneBtn = document.getElementById('phone-btn');
        const tabletBtn = document.getElementById('tablet-btn');
        const laptopBtn = document.getElementById('laptop-btn');
        const pageSelector = document.getElementById('page-selector');
        const pageNameInput = document.getElementById('page-name');
        const applyCodeBtn = document.getElementById('apply-code-btn');

        let dragging = null;
        let offsetX = 0;
        let offsetY = 0;
        let selected = null;
        let mode = 'edit';
        let currentPage = 'page1';
        let pages = { 'page1': { name: 'index.html', html: '', css: '', js: '', elements: [] } };
        let pageCount = 1;
        let activeDropdown = null;
        const resizeObserver = new ResizeObserver(() => updateCode());

        const elementCategories = {
            'shapes': [
                { type: 'div', class: 'shape rectangle', width: '100', height: '50', name: 'Rectangle' },
                { type: 'div', class: 'shape square', width: '100', height: '100', name: 'Square' },
                { type: 'div', class: 'shape rounded-rectangle', width: '100', height: '50', name: 'Rounded Rectangle' },
                { type: 'div', class: 'shape circle', width: '50', height: '50', name: 'Circle' },
                { type: 'div', class: 'shape oval', width: '100', height: '50', name: 'Oval' },
                { type: 'div', class: 'shape triangle', width: '100', height: '100', name: 'Triangle' },
                { type: 'div', class: 'shape pentagon', width: '100', height: '100', name: 'Pentagon' },
                { type: 'div', class: 'shape hexagon', width: '100', height: '100', name: 'Hexagon' },
                { type: 'div', class: 'shape octagon', width: '100', height: '100', name: 'Octagon' },
                { type: 'div', class: 'shape trapezoid', width: '100', height: '50', name: 'Trapezoid' },
                { type: 'div', class: 'shape diamond', width: '100', height: '100', name: 'Diamond' },
                { type: 'div', class: 'shape star', width: '100', height: '100', name: 'Star' }
            ],
            'icons': [
                { type: 'i', class: 'fas fa-home icon', width: '30', height: '30', name: 'Home Icon' },
                { type: 'i', class: 'fas fa-user icon', width: '30', height: '30', name: 'User Icon' },
                { type: 'i', class: 'fas fa-cog icon', width: '30', height: '30', name: 'Settings Icon' },
                { type: 'i', class: 'fas fa-search icon', width: '30', height: '30', name: 'Search Icon' },
                { type: 'i', class: 'fas fa-heart icon', width: '30', height: '30', name: 'Heart Icon' },
                { type: 'i', class: 'fas fa-star icon', width: '30', height: '30', name: 'Star Icon' },
                { type: 'i', class: 'fas fa-bell icon', width: '30', height: '30', name: 'Bell Icon' },
                { type: 'i', class: 'fas fa-camera icon', width: '30', height: '30', name: 'Camera Icon' },
                { type: 'i', class: 'fas fa-envelope icon', width: '30', height: '30', name: 'Email Icon' },
                { type: 'i', class: 'fas fa-shopping-cart icon', width: '30', height: '30', name: 'Cart Icon' },
                { type: 'i', class: 'fas fa-cloud icon', width: '30', height: '30', name: 'Cloud Icon' },
                { type: 'i', class: 'fas fa-lock icon', width: '30', height: '30', name: 'Lock Icon' }
            ],
            'social-icons': [
                { type: 'a', class: 'fab fa-facebook-f social-icon', width: '30', height: '30', name: 'Facebook' },
                { type: 'a', class: 'fab fa-twitter social-icon', width: '30', height: '30', name: 'Twitter' },
                { type: 'a', class: 'fab fa-instagram social-icon', width: '30', height: '30', name: 'Instagram' },
                { type: 'a', class: 'fab fa-linkedin-in social-icon', width: '30', height: '30', name: 'LinkedIn' },
                { type: 'a', class: 'fab fa-github social-icon', width: '30', height: '30', name: 'GitHub' },
                { type: 'a', class: 'fab fa-youtube social-icon', width: '30', height: '30', name: 'YouTube' },
                { type: 'a', class: 'fab fa-tiktok social-icon', width: '30', height: '30', name: 'TikTok' },
                { type: 'a', class: 'fab fa-discord social-icon', width: '30', height: '30', name: 'Discord' },
                { type: 'a', class: 'fab fa-pinterest social-icon', width: '30', height: '30', name: 'Pinterest' },
                { type: 'a', class: 'fab fa-whatsapp social-icon', width: '30', height: '30', name: 'WhatsApp' }
            ],
            'material-icons': [
                { type: 'i', class: 'material-icons icon', content: 'home', width: '30', height: '30', name: 'Home' },
                { type: 'i', class: 'material-icons icon', content: 'person', width: '30', height: '30', name: 'Person' },
                { type: 'i', class: 'material-icons icon', content: 'settings', width: '30', height: '30', name: 'Settings' },
                { type: 'i', class: 'material-icons icon', content: 'search', width: '30', height: '30', name: 'Search' },
                { type: 'i', class: 'material-icons icon', content: 'favorite', width: '30', height: '30', name: 'Favorite' },
                { type: 'i', class: 'material-icons icon', content: 'star', width: '30', height: '30', name: 'Star' },
                { type: 'i', class: 'material-icons icon', content: 'notifications', width: '30', height: '30', name: 'Notifications' },
                { type: 'i', class: 'material-icons icon', content: 'camera_alt', width: '30', height: '30', name: 'Camera' }
            ],
            'navigations': [
                { type: 'nav', class: 'navigation bar', content: '<ul><li><a href="#">Home</a></li><li><a href="#">About</a></li><li><a href="#">Contact</a></li></ul>', width: '400', height: '40', name: 'Horizontal Nav Bar' },
                { type: 'nav', class: 'navigation sidebar', content: '<ul><li><a href="#">Home</a></li><li><a href="#">About</a></li><li><a href="#">Contact</a></li></ul>', width: '150', height: '200', name: 'Vertical Sidebar' },
                { type: 'footer', class: 'navigation footer', content: '<p>Footer Content</p>', width: '400', height: '50', name: 'Footer Nav' },
                { type: 'header', class: 'navigation header', content: '<h1>Header</h1>', width: '400', height: '50', name: 'Header Nav' },
                { type: 'nav', class: 'navigation breadcrumb', content: '<ul><li><a href="#">Home</a></li><li><a href="#">Category</a></li><li><a href="#">Page</a></li></ul>', width: '400', height: '30', name: 'Breadcrumb' },
                { type: 'nav', class: 'navigation sticky-nav', content: '<ul><li><a href="#">Home</a></li><li><a href="#">Services</a></li><li><a href="#">Contact</a></li></ul>', width: '400', height: '40', name: 'Sticky Nav' }
            ],
            'menus': [
                { type: 'select', class: 'menu dropdown', content: '<option>Option 1</option><option>Option 2</option><option>Option 3</option>', width: '150', height: '30', name: 'Dropdown Menu' },
                { type: 'ul', class: 'menu list', content: '<li>Item 1</li><li>Item 2</li><li>Item 3</li>', width: '150', height: '100', name: 'List Menu' },
                { type: 'input', class: 'menu radio', 'input-type': 'radio', name: 'group1', width: '30', height: '30', name: 'Radio Button' },
                { type: 'input', class: 'menu checkbox', 'input-type': 'checkbox', width: '30', height: '30', name: 'Checkbox' },
                { type: 'select', class: 'menu multiselect', content: '<option>Option 1</option><option>Option 2</option><option>Option 3</option>', width: '150', height: '100', name: 'Multi-Select' },
                { type: 'div', class: 'menu context-menu', content: '<ul><li>Option 1</li><li>Option 2</li><li>Option 3</li></ul>', width: '150', height: '100', name: 'Context Menu' }
            ],
            'media': [
                { type: 'img', class: 'media image', width: '150', height: '150', name: 'Image' },
                { type: 'video', class: 'media video', width: '320', height: '240', name: 'Video' },
                { type: 'audio', class: 'media audio', width: '200', height: '30', name: 'Audio' },
                { type: 'iframe', class: 'media iframe', width: '300', height: '200', name: 'Iframe' },
                { type: 'picture', class: 'media picture', width: '150', height: '150', name: 'Picture' },
                { type: 'video', class: 'media video-loop', width: '320', height: '240', name: 'Looping Video' }
            ],
            'forms': [
                { type: 'form', class: 'form container', content: '<input type="text" placeholder="Name"><input type="email" placeholder="Email"><button>Submit</button>', width: '300', height: '150', name: 'Basic Form' },
                { type: 'input', class: 'form text', 'input-type': 'text', placeholder: 'Enter text', width: '200', height: '30', name: 'Text Input' },
                { type: 'input', class: 'form email', 'input-type': 'email', placeholder: 'Enter email', width: '200', height: '30', name: 'Email Input' },
                { type: 'input', class: 'form password', 'input-type': 'password', placeholder: 'Enter password', width: '200', height: '30', name: 'Password Input' },
                { type: 'textarea', class: 'form textarea', placeholder: 'Enter message', width: '200', height: '100', name: 'Textarea' },
                { type: 'button', class: 'form button', content: 'Submit', width: '100', height: '30', name: 'Button' },
                { type: 'input', class: 'form file', 'input-type': 'file', width: '200', height: '30', name: 'File Upload' },
                { type: 'input', class: 'form number', 'input-type': 'number', placeholder: 'Enter number', width: '200', height: '30', name: 'Number Input' },
                { type: 'input', class: 'form date', 'input-type': 'date', width: '200', height: '30', name: 'Date Input' },
                { type: 'input', class: 'form range', 'input-type': 'range', width: '200', height: '30', name: 'Range Slider' },
                { type: 'input', class: 'form color', 'input-type': 'color', width: '100', height: '30', name: 'Color Picker' }
            ],
            'utilities': [
                { type: 'div', class: 'utility container', width: '200', height: '100', name: 'Container Div' },
                { type: 'section', class: 'utility section', width: '300', height: '150', name: 'Section' },
                { type: 'article', class: 'utility article', width: '300', height: '150', name: 'Article' },
                { type: 'aside', class: 'utility aside', width: '150', height: '200', name: 'Aside' },
                { type: 'p', class: 'utility paragraph', content: 'Paragraph text', width: '200', height: '50', name: 'Paragraph' },
                { type: 'div', class: 'utility card', width: '200', height: '150', name: 'Card' },
                { type: 'hr', class: 'utility divider', width: '200', height: '2', name: 'Divider' },
                { type: 'div', class: 'utility grid', content: '<div>Grid Item 1</div><div>Grid Item 2</div><div>Grid Item 3</div>', width: '300', height: '150', name: 'Grid Container' },
                { type: 'div', class: 'utility flexbox', content: '<div>Flex Item 1</div><div>Flex Item 2</div><div>Flex Item 3</div>', width: '300', height: '150', name: 'Flexbox Container' }
            ],
            'creatives': [
                { type: 'canvas', class: 'creative canvas', width: '200', height: '200', name: 'Canvas' },
                { type: 'svg', class: 'creative svg', content: '<rect width="100" height="50" fill="blue"/>', width: '200', height: '200', name: 'SVG' },
                { type: 'div', class: 'creative animation', width: '100', height: '100', name: 'Animation Box' },
                { type: 'div', class: 'creative carousel', content: '<div>Slide 1</div><div>Slide 2</div><div>Slide 3</div>', width: '300', height: '200', name: 'Carousel' },
                { type: 'div', class: 'creative parallax', width: '300', height: '200', name: 'Parallax Section' }
            ],
            'modals': [
                { type: 'div', class: 'modal basic', content: '<h2>Modal Title</h2><p>Modal content goes here.</p><button>Close</button>', width: '300', height: '200', name: 'Basic Modal' },
                { type: 'div', class: 'modal centered', content: '<h2>Centered Modal</h2><p>Centered modal content.</p><button>Close</button>', width: '300', height: '200', name: 'Centered Modal' },
                { type: 'div', class: 'modal fullscreen', content: '<h2>Fullscreen Modal</h2><p>Fullscreen content.</p><button>Close</button>', width: '400', height: '300', name: 'Fullscreen Modal' }
            ],
            'buttons': [
                { type: 'button', class: 'button primary', content: 'Primary Button', width: '100', height: '40', name: 'Primary Button' },
                { type: 'button', class: 'button secondary', content: 'Secondary Button', width: '100', height: '40', name: 'Secondary Button' },
                { type: 'button', class: 'button outline', content: 'Outline Button', width: '100', height: '40', name: 'Outline Button' },
                { type: 'button', class: 'button icon-button', content: '<i class="fas fa-play"></i>', width: '40', height: '40', name: 'Icon Button' }
            ],
            'cards': [
                { type: 'div', class: 'card basic', content: '<h3>Card Title</h3><p>Card content goes here.</p>', width: '200', height: '150', name: 'Basic Card' },
                { type: 'div', class: 'card image-card', content: '<img src="" alt="Card Image"><h3>Card Title</h3><p>Card content.</p>', width: '200', height: '200', name: 'Image Card' },
                { type: 'div', class: 'card hover-card', content: '<h3>Hover Card</h3><p>Hover to see effect.</p>', width: '200', height: '150', name: 'Hover Card' }
            ],
            'sliders': [
                { type: 'div', class: 'slider basic', content: '<div>Slide 1</div><div>Slide 2</div><div>Slide 3</div>', width: '300', height: '200', name: 'Basic Slider' },
                { type: 'div', class: 'slider image-slider', content: '<img src="" alt="Slide 1"><img src="" alt="Slide 2"><img src="" alt="Slide 3">', width: '300', height: '200', name: 'Image Slider' }
            ],
            'fonts': [
                { type: 'p', class: 'font roboto', content: 'Roboto Text', width: '200', height: '50', name: 'Roboto' },
                { type: 'p', class: 'font open-sans', content: 'Open Sans Text', width: '200', height: '50', name: 'Open Sans' },
                { type: 'p', class: 'font montserrat', content: 'Montserrat Text', width: '200', height: '50', name: 'Montserrat' },
                { type: 'p', class: 'font lato', content: 'Lato Text', width: '200', height: '50', name: 'Lato' },
                { type: 'p', class: 'font poppins', content: 'Poppins Text', width: '200', height: '50', name: 'Poppins' },
                { type: 'p', class: 'font nunito', content: 'Nunito Text', width: '200', height: '50', name: 'Nunito' }
            ]
        };

        // Mode switching
        function setMode(newMode) {
            mode = newMode;
            workspace.classList.remove('edit-mode', 'view-mode');
            workspace.classList.add(`${mode}-mode`);
            editModeBtn.classList.toggle('active', mode === 'edit');
            viewModeBtn.classList.toggle('active', mode === 'view');
            phoneBtn.style.display = mode === 'view' ? 'inline-block' : 'none';
            tabletBtn.style.display = mode === 'view' ? 'inline-block' : 'none';
            laptopBtn.style.display = mode === 'view' ? 'inline-block' : 'none';
            document.querySelectorAll('#top-menu button[id$="-btn"]').forEach(btn => {
                if (!['edit-mode-btn', 'view-mode-btn', 'phone-btn', 'tablet-btn', 'laptop-btn'].includes(btn.id)) {
                    btn.style.display = mode === 'edit' ? 'inline-block' : 'none';
                }
            });
            document.getElementById('properties').style.display = mode === 'edit' ? 'block' : 'none';
            pageNav.style.display = mode === 'edit' ? 'flex' : 'none';
            applyCodeBtn.style.display = mode === 'view' ? 'inline-block' : 'none';
            if (mode === 'view') {
                if (selected) {
                    selected.style.border = '';
                    selected.classList.remove('selected');
                }
                selected = null;
                propContent.innerHTML = '';
                deleteBtn.style.display = 'none';
                closeDropdown();
                setPreview('laptop');
                updatePreview();
            } else {
                workspace.classList.remove('phone', 'tablet', 'laptop');
                workspace.innerHTML = '';
                pages[currentPage].elements.forEach(({ element, style, attributes, innerHTML, classList }) => {
                    const newEl = element.cloneNode(false);
                    newEl.innerHTML = innerHTML;
                    newEl.className = classList.join(' ');
                    Object.assign(newEl.style, style);
                    Object.entries(attributes).forEach(([name, value]) => {
                        newEl.setAttribute(name, value);
                    });
                    workspace.appendChild(newEl);
                    attachEventListeners(newEl);
                    resizeObserver.observe(newEl);
                });
            }
            updateCode();
        }

        // Preview mode
        function setPreview(device) {
            if (mode !== 'view') return;
            workspace.classList.remove('phone', 'tablet', 'laptop');
            workspace.classList.add(device);
            phoneBtn.classList.toggle('active', device === 'phone');
            tabletBtn.classList.toggle('active', device === 'tablet');
            laptopBtn.classList.toggle('active', device === 'laptop');
            updatePreview();
        }

        // Update preview in view mode
        function updatePreview() {
            if (mode !== 'view') return;
            workspace.innerHTML = '<iframe id="previewFrame"></iframe>';
            const iframe = document.getElementById('previewFrame');
            const htmlCode = htmlArea.value || '<html><body></body></html>';
            const cssCode = cssArea.value || '';
            const jsCode = jsArea.value || '';
            const fullHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <style>${cssCode}</style>
                </head>
                <body>
                    ${htmlCode}
                    <script>${jsCode}<\/script>
                </body>
                </html>
            `;
            const doc = iframe.contentDocument || iframe.contentWindow.document;
            doc.open();
            doc.write(fullHtml);
            doc.close();
        }

        // Save page state
        function savePageState(pageId) {
            if (mode === 'edit') {
                pages[pageId].elements = Array.from(workspace.children).map(el => {
                    const attributes = {};
                    Array.from(el.attributes).forEach(attr => {
                        attributes[attr.name] = attr.value;
                    });
                    const style = {};
                    Object.assign(style, el.style);
                    return {
                        element: el.cloneNode(true),
                        style: style,
                        attributes: attributes,
                        innerHTML: el.innerHTML,
                        textContent: el.textContent,
                        classList: Array.from(el.classList)
                    };
                });
            }
            pages[pageId].html = htmlArea.value;
            pages[pageId].css = cssArea.value;
            pages[pageId].js = jsArea.value;
            pages[pageId].name = pageNameInput.value;
        }

        // Page management
        function newPage() {
            savePageState(currentPage);
            pageCount++;
            const newPageId = `page${pageCount}`;
            const pageName = `page${pageCount}.html`;
            pages[newPageId] = { name: pageName, html: '', css: '', js: '', elements: [] };
            const option = document.createElement('option');
            option.value = newPageId;
            option.textContent = pageName;
            option.dataset.name = pageName;
            pageSelector.appendChild(option);
            switchPage(newPageId);
            pageNameInput.value = pageName;
        }

        function switchPage(pageId) {
            if (pageId === currentPage) return;
            savePageState(currentPage);
            pageSelector.querySelector(`option[value="${currentPage}"]`).textContent = pageNameInput.value;
            pageSelector.querySelector(`option[value="${currentPage}"]`).dataset.name = pageNameInput.value;

            currentPage = pageId;
            workspace.innerHTML = '';
            if (mode === 'edit') {
                pages[pageId].elements.forEach(({ element, style, attributes, innerHTML, classList }) => {
                    const newEl = element.cloneNode(false);
                    newEl.innerHTML = innerHTML;
                    newEl.className = classList.join(' ');
                    Object.assign(newEl.style, style);
                    Object.entries(attributes).forEach(([name, value]) => {
                        newEl.setAttribute(name, value);
                    });
                    workspace.appendChild(newEl);
                    attachEventListeners(newEl);
                    resizeObserver.observe(newEl);
                });
            } else {
                updatePreview();
            }
            htmlArea.value = pages[pageId].html || '';
            cssArea.value = pages[pageId].css || '';
            jsArea.value = pages[pageId].js || '// No JS generated yet';
            pageSelector.value = pageId;
            pageNameInput.value = pages[pageId].name;
            if (selected) {
                selected.style.border = '';
                selected.classList.remove('selected');
                selected = null;
                propContent.innerHTML = '';
                deleteBtn.style.display = 'none';
            }
            closeDropdown();
            updateCode();
        }

        // Update page name
        pageNameInput.addEventListener('input', () => {
            pages[currentPage].name = pageNameInput.value;
            pageSelector.querySelector(`option[value="${currentPage}"]`).textContent = pageNameInput.value;
            pageSelector.querySelector(`option[value="${currentPage}"]`).dataset.name = pageNameInput.value;
            savePageState(currentPage);
        });

        // Dropdown management
        function openCategory(categoryId, button) {
            if (mode !== 'edit') return;
            closeDropdown();
            const dropdown = document.createElement('div');
            dropdown.className = 'dropdown';
            const ul = document.createElement('ul');
            elementCategories[categoryId].forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.name;
                li.setAttribute('draggable', 'true');
                li.dataset.type = item.type;
                li.dataset.class = item.class;
                if (item.content) li.dataset.content = item.content;
                if (item.width) li.dataset.width = item.width;
                if (item.height) li.dataset.height = item.height;
                if (item['input-type']) li.dataset.inputType = item['input-type'];
                if (item.placeholder) li.dataset.placeholder = item.placeholder;
                if (item.nameAttr) li.dataset.name = item.nameAttr;
                li.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('type', li.dataset.type);
                    e.dataTransfer.setData('class', li.dataset.class);
                    e.dataTransfer.setData('content', li.dataset.content || '');
                    e.dataTransfer.setData('width', li.dataset.width || '100');
                    e.dataTransfer.setData('height', li.dataset.height || '50');
                    e.dataTransfer.setData('input-type', li.dataset.inputType || '');
                    e.dataTransfer.setData('placeholder', li.dataset.placeholder || '');
                    e.dataTransfer.setData('name', li.dataset.name || '');
                });
                li.addEventListener('click', () => {
                    addElementToWorkspace(item, { offsetX: 100, offsetY: 100 });
                    closeDropdown();
                });
                ul.appendChild(li);
            });
            dropdown.appendChild(ul);
            document.getElementById('top-menu').appendChild(dropdown);
            const rect = button.getBoundingClientRect();
            dropdown.style.left = `${rect.left - document.getElementById('top-menu').getBoundingClientRect().left}px`;
            dropdown.style.display = 'block';
            activeDropdown = dropdown;
        }

        function closeDropdown() {
            if (activeDropdown) {
                activeDropdown.remove();
                activeDropdown = null;
            }
        }

        // Textarea controls
        function pasteCode(type) {
            navigator.clipboard.readText().then(text => {
                document.getElementById(type).value = text;
                if (mode === 'view') updatePreview();
                else applyCode();
            }).catch(() => {
                alert('Failed to paste content. Ensure clipboard access is allowed.');
            });
        }

        function clearCode(type) {
            document.getElementById(type).value = '';
            if (mode === 'view') updatePreview();
            else applyCode();
        }

        function copyCode(type) {
            const textarea = document.getElementById(type);
            textarea.select();
            navigator.clipboard.writeText(textarea.value).then(() => {
                alert(`${type.toUpperCase()} copied to clipboard!`);
            }).catch(() => {
                alert('Failed to copy content.');
            });
        }

        function distinguishCode() {
            let htmlContent = htmlArea.value;
            let cssContent = '';
            let jsContent = '';

            // Extract CSS from <style> tags
            const styleRegex = /<style[^>]*>([\s\S]*?)<\/style>/gi;
            let styleMatch;
            while ((styleMatch = styleRegex.exec(htmlContent)) !== null) {
                cssContent += styleMatch[1].trim() + '\n';
                htmlContent = htmlContent.replace(styleMatch[0], '');
            }

            // Extract JavaScript from <script> tags
            const scriptRegex = /<script[^>]*>([\s\S]*?)<\/script>/gi;
            let scriptMatch;
            while ((scriptMatch = scriptRegex.exec(htmlContent)) !== null) {
                jsContent += scriptMatch[1].trim() + '\n';
                htmlContent = htmlContent.replace(scriptMatch[0], '');
            }

            // Update textareas
            htmlArea.value = htmlContent.trim();
            cssArea.value = cssContent.trim();
            jsArea.value = jsContent.trim() || '// No JS generated yet';

            if (mode === 'view') updatePreview();
            else applyCode();
            savePageState(currentPage);
        }

        // Attach event listeners to elements
        function attachEventListeners(el) {
            if (el.tagName === 'FORM') {
                el.addEventListener('submit', (ev) => {
                    ev.preventDefault();
                    console.log('Form submitted:', new FormData(el));
                    alert('Form submitted! Check console for data.');
                });
            }
            if (el.tagName === 'BUTTON' || el.className.includes('button')) {
                el.addEventListener('click', () => {
                    if (mode === 'view' && el.dataset.pageLink) {
                        switchPage(el.dataset.pageLink);
                        setMode('view');
                    } else if (mode === 'view') {
                        console.log('Button clicked!');
                        alert('Button clicked!');
                    }
                });
            }
            if (el.querySelectorAll('a').length > 0 || el.tagName === 'A') {
                if (el.tagName === 'A') {
                    el.addEventListener('click', (ev) => {
                        if (mode === 'view') {
                            ev.preventDefault();
                            if (el.dataset.pageLink) {
                                switchPage(el.dataset.pageLink);
                                setMode('view');
                            } else {
                                console.log('Link clicked:', el.href);
                                alert(`Link clicked: ${el.href}`);
                            }
                        }
                    });
                } else {
                    el.querySelectorAll('a').forEach(a => {
                        a.addEventListener('click', (ev) => {
                            if (mode === 'view') {
                                ev.preventDefault();
                                if (a.dataset.pageLink) {
                                    switchPage(a.dataset.pageLink);
                                    setMode('view');
                                } else {
                                    console.log('Link clicked:', a.href);
                                    alert(`Link clicked: ${a.href}`);
                                }
                            }
                        });
                    });
                }
            }
        }

        // Add element to workspace
        function addElementToWorkspace(item, position) {
            const elem = document.createElement(item.type);
            elem.className = item.class;
            elem.style.position = 'absolute';
            elem.style.left = `${position.offsetX - (parseInt(item.width) / 2)}px`;
            elem.style.top = `${position.offsetY - (parseInt(item.height) / 2)}px`;
            elem.style.width = `${item.width}px`;
            elem.style.height = `${item.height}px`;

            if (item.content) elem.innerHTML = item.content;
            if (item['input-type']) elem.type = item['input-type'];
            if (item.placeholder) elem.placeholder = item.placeholder;
            if (item.nameAttr) elem.name = item.nameAttr;
            if (item.class.includes('font')) {
                if (item.class.includes('roboto')) elem.style.fontFamily = 'Roboto';
                if (item.class.includes('open-sans')) elem.style.fontFamily = 'Open Sans';
                if (item.class.includes('montserrat')) elem.style.fontFamily = 'Montserrat';
                if (item.class.includes('lato')) elem.style.fontFamily = 'Lato';
                if (item.class.includes('poppins')) elem.style.fontFamily = 'Poppins';
                if (item.class.includes('nunito')) elem.style.fontFamily = 'Nunito';
            }
            if (item.class.includes('circle') || item.class.includes('oval')) {
                elem.style.borderRadius = '50%';
            }
            if (item.class.includes('rectangle') || item.class.includes('square') || item.class.includes('container') || item.class.includes('card') || item.class.includes('rounded-rectangle')) {
                elem.style.backgroundColor = '#444';
                elem.style.border = '1px solid #666';
                if (item.class.includes('rounded-rectangle')) elem.style.borderRadius = '10px';
            }
            if (item.class.includes('triangle')) {
                elem.style.width = '0';
                elem.style.height = '0';
                elem.style.borderLeft = '50px solid transparent';
                elem.style.borderRight = '50px solid transparent';
                elem.style.borderBottom = '100px solid #28a745';
                elem.style.backgroundColor = 'transparent';
                elem.style.resize = 'none';
            }
            if (item.class.includes('icon') || item.class.includes('social-icon') || item.class.includes('material-icons')) {
                elem.style.display = 'inline-block';
                if (item.content && item.class.includes('material-icons')) {
                    elem.textContent = item.content;
                }
            }
            if (item.type === 'button') {
                elem.textContent = item.content || 'Button';
            }
            if (item.type === 'video' || item.type === 'audio') {
                elem.controls = true;
                elem.src = '';
            }
            if (item.type === 'img' || item.type === 'iframe' || item.type === 'picture') {
                elem.src = '';
            }
            if (item.class.includes('modal')) {
                elem.style.zIndex = '1000';
            }
            attachEventListeners(elem);
            workspace.appendChild(elem);
            resizeObserver.observe(elem);
            savePageState(currentPage);
            updateCode();
        }

        // Drag from dropdown to workspace
        workspace.addEventListener('dragover', (e) => {
            if (mode === 'edit') e.preventDefault();
        });
        workspace.addEventListener('drop', (e) => {
            if (mode !== 'edit') return;
            e.preventDefault();
            const type = e.dataTransfer.getData('type');
            const className = e.dataTransfer.getData('class');
            const content = e.dataTransfer.getData('content');
            const width = e.dataTransfer.getData('width');
            const height = e.dataTransfer.getData('height');
            const inputType = e.dataTransfer.getData('input-type');
            const placeholder = e.dataTransfer.getData('placeholder');
            const name = e.dataTransfer.getData('name');

            addElementToWorkspace({
                type,
                class: className,
                content,
                width,
                height,
                'input-type': inputType,
                placeholder,
                nameAttr: name
            }, { offsetX: e.offsetX, offsetY: e.offsetY });
            closeDropdown();
        });

        // Dragging elements within workspace
        workspace.addEventListener('mousedown', (e) => {
            if (mode !== 'edit') return;
            if (e.target !== workspace && e.target.parentElement === workspace) {
                dragging = e.target;
                const rect = workspace.getBoundingClientRect();
                offsetX = e.clientX - rect.left - parseFloat(dragging.style.left || 0);
                offsetY = e.clientY - rect.top - parseFloat(dragging.style.top || 0);
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (mode !== 'edit' || !dragging) return;
            const rect = workspace.getBoundingClientRect();
            dragging.style.left = `${e.clientX - rect.left - offsetX}px`;
            dragging.style.top = `${e.clientY - rect.top - offsetY}px`;
        });

        document.addEventListener('mouseup', () => {
            if (dragging) {
                savePageState(currentPage);
                updateCode();
                dragging = null;
            }
        });

        // Selection for properties
        workspace.addEventListener('click', (e) => {
            if (mode !== 'edit') return;
            if (selected) {
                selected.style.border = '';
                selected.classList.remove('selected');
            }
            if (e.target === workspace) {
                selected = null;
                propContent.innerHTML = '';
                deleteBtn.style.display = 'none';
            } else {
                selected = e.target;
                selected.style.border = '1px dashed white';
                selected.classList.add('selected');
                showProperties();
                deleteBtn.style.display = 'block';
            }
            e.stopPropagation();
        });

        // Delete button
        deleteBtn.addEventListener('click', () => {
            if (mode !== 'edit' || !selected) return;
            resizeObserver.unobserve(selected);
            selected.remove();
            selected = null;
            propContent.innerHTML = '';
            deleteBtn.style.display = 'none';
            savePageState(currentPage);
            updateCode();
        });

        // Keyboard delete
        document.addEventListener('keydown', (e) => {
            if (mode !== 'edit' || e.key !== 'Delete' || !selected) return;
            resizeObserver.unobserve(selected);
            selected.remove();
            selected = null;
            propContent.innerHTML = '';
            deleteBtn.style.display = 'none';
            savePageState(currentPage);
            updateCode();
        });

        function showProperties() {
            if (!selected) return;
            const compStyle = getComputedStyle(selected);
            const width = parseInt(selected.style.width) || parseInt(compStyle.width);
            const height = parseInt(selected.style.height) || parseInt(compStyle.height);
            const left = parseInt(selected.style.left) || 0;
            const top = parseInt(selected.style.top) || 0;
            const bgColor = rgbToHex(compStyle.backgroundColor);
            const textColor = rgbToHex(compStyle.color);
            const fontSize = parseInt(compStyle.fontSize) || 16;
            const fontFamily = compStyle.fontFamily || 'Roboto';
            const borderRadius = compStyle.borderRadius || '0px';
            const borderWidth = compStyle.borderWidth || '0px';
            const borderColor = rgbToHex(compStyle.borderColor);
            const borderStyle = compStyle.borderStyle || 'none';
            const contentEditable = selected.tagName === 'P' || selected.tagName === 'SPAN' || selected.tagName === 'BUTTON' || selected.className.includes('paragraph');
            const isMedia = selected.tagName === 'IMG' || selected.tagName === 'VIDEO' || selected.tagName === 'AUDIO' || selected.tagName === 'IFRAME' || selected.tagName === 'PICTURE';
            const isLink = selected.tagName === 'A' || selected.tagName === 'BUTTON' || selected.className.includes('button');
            const isInput = selected.tagName === 'INPUT' || selected.tagName === 'TEXTAREA';
            const isNav = selected.className.includes('navigation');
            const isModal = selected.className.includes('modal');

            let content = `
                <label>Left: <input type="number" id="prop-left" value="${left}"></label>
                <label>Top: <input type="number" id="prop-top" value="${top}"></label>
                <label>Width: <input type="number" id="prop-width" value="${width}"></label>
                <label>Height: <input type="number" id="prop-height" value="${height}"></label>
                <label>Background Color: <input type="color" id="prop-bgcolor" value="${bgColor}"></label>
                <label>Text Color: <input type="color" id="prop-color" value="${textColor}"></label>
                <label>Font Size: <input type="number" id="prop-fontsize" value="${fontSize}"></label>
                <label>Font Family: <select id="prop-fontfamily">
                    <option value="Roboto" ${fontFamily.includes('Roboto') ? 'selected' : ''}>Roboto</option>
                    <option value="Open Sans" ${fontFamily.includes('Open Sans') ? 'selected' : ''}>Open Sans</option>
                    <option value="Montserrat" ${fontFamily.includes('Montserrat') ? 'selected' : ''}>Montserrat</option>
                    <option value="Lato" ${fontFamily.includes('Lato') ? 'selected' : ''}>Lato</option>
                    <option value="Poppins" ${fontFamily.includes('Poppins') ? 'selected' : ''}>Poppins</option>
                    <option value="Nunito" ${fontFamily.includes('Nunito') ? 'selected' : ''}>Nunito</option>
                </select></label>
                <label>Border Radius: <input type="text" id="prop-borderradius" value="${borderRadius}"></label>
                <label>Border Width: <input type="text" id="prop-borderwidth" value="${borderWidth}"></label>
                <label>Border Color: <input type="color" id="prop-bordercolor" value="${borderColor}"></label>
                <label>Border Style: <select id="prop-borderstyle">
                    <option value="none" ${borderStyle === 'none' ? 'selected' : ''}>None</option>
                    <option value="solid" ${borderStyle === 'solid' ? 'selected' : ''}>Solid</option>
                    <option value="dashed" ${borderStyle === 'dashed' ? 'selected' : ''}>Dashed</option>
                    <option value="dotted" ${borderStyle === 'dotted' ? 'selected' : ''}>Dotted</option>
                </select></label>
            `;

            if (contentEditable) {
                content += `<label>Text: <input type="text" id="prop-text" value="${selected.textContent.trim()}"></label>`;
            }
            if (isMedia) {
                content += `<label>Source URL: <input type="text" id="prop-src" value="${selected.src || ''}"></label>`;
            }
            if (isLink) {
                content += `<label>External Link URL: <input type="text" id="prop-href" value="${selected.href || ''}"></label>`;
                content += `<label>Link to Page: <select id="prop-page-link"><option value="">None</option>`;
                Object.keys(pages).forEach(pageId => {
                    content += `<option value="${pageId}" ${selected.dataset.pageLink === pageId ? 'selected' : ''}>${pages[pageId].name}</option>`;
                });
                content += `</select></label>`;
            }
            if (isInput) {
                content += `<label>Placeholder: <input type="text" id="prop-placeholder" value="${selected.placeholder || ''}"></label>`;
            }
            if (isNav) {
                const items = Array.from(selected.querySelectorAll('li')).map(li => li.innerHTML).join('\n');
                content += `<label>Nav Items: <textarea id="prop-navitems">${items}</textarea></label>`;
            }
            if (isModal) {
                content += `<label>Z-Index: <input type="number" id="prop-zindex" value="${selected.style.zIndex || 1000}"></label>`;
            }

            propContent.innerHTML = content;

            document.getElementById('prop-left').addEventListener('input', (e) => {
                selected.style.left = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-top').addEventListener('input', (e) => {
                selected.style.top = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-width').addEventListener('input', (e) => {
                selected.style.width = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-height').addEventListener('input', (e) => {
                selected.style.height = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-bgcolor').addEventListener('input', (e) => {
                selected.style.backgroundColor = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-color').addEventListener('input', (e) => {
                selected.style.color = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-fontsize').addEventListener('input', (e) => {
                selected.style.fontSize = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-fontfamily').addEventListener('change', (e) => {
                selected.style.fontFamily = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-borderradius').addEventListener('input', (e) => {
                selected.style.borderRadius = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-borderwidth').addEventListener('input', (e) => {
                selected.style.borderWidth = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-bordercolor').addEventListener('input', (e) => {
                selected.style.borderColor = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-borderstyle').addEventListener('change', (e) => {
                selected.style.borderStyle = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            if (contentEditable) {
                document.getElementById('prop-text').addEventListener('input', (e) => {
                    selected.textContent = e.target.value;
                    savePageState(currentPage);
                    updateCode();
                });
            }
            if (isMedia) {
                document.getElementById('prop-src').addEventListener('input', (e) => {
                    selected.src = e.target.value;
                    savePageState(currentPage);
                    updateCode();
                });
            }
            if (isLink) {
                document.getElementById('prop-href').addEventListener('input', (e) => {
                    selected.href = e.target.value;
                    savePageState(currentPage);
                    updateCode();
                });
                document.getElementById('prop-page-link').addEventListener('change', (e) => {
                    if (e.target.value) {
                        selected.dataset.pageLink = e.target.value;
                        selected.href = '#';
                    } else {
                        delete selected.dataset.pageLink;
                        selected.href = document.getElementById('prop-href').value || '';
                    }
                    savePageState(currentPage);
                    updateCode();
                });
            }
            if (isInput) {
                document.getElementById('prop-placeholder').addEventListener('input', (e) => {
                    selected.placeholder = e.target.value;
                    savePageState(currentPage);
                    updateCode();
                });
            }
            if (isNav) {
                document.getElementById('prop-navitems').addEventListener('input', (e) => {
                    selected.innerHTML = e.target.value;
                    selected.querySelectorAll('a').forEach(a => {
                        a.addEventListener('click', (ev) => {
                            if (mode === 'view') {
                                ev.preventDefault();
                                if (a.dataset.pageLink) {
                                    switchPage(a.dataset.pageLink);
                                    setMode('view');
                                } else {
                                    console.log('Link clicked:', a.href);
                                    alert(`Link clicked: ${a.href}`);
                                }
                            }
                        });
                    });
                    savePageState(currentPage);
                    updateCode();
                });
            }
            if (isModal) {
                document.getElementById('prop-zindex').addEventListener('input', (e) => {
                    selected.style.zIndex = e.target.value;
                    savePageState(currentPage);
                    updateCode();
                });
            }
        }

        function rgbToHex(rgb) {
            if (!rgb || rgb === 'rgba(0, 0, 0, 0)') return '#000000';
            const [r, g, b] = rgb.match(/\d+/g).map(Number);
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
        }

        // Apply external code
        function applyCode() {
            if (mode === 'view') {
                updatePreview();
                return;
            }
            workspace.innerHTML = '';
            const html = htmlArea.value;
            const css = cssArea.value;
            const js = jsArea.value;

            // Remove existing styles and scripts
            document.querySelectorAll('style[data-dynamic]').forEach(style => style.remove());
            document.querySelectorAll('script[data-dynamic]').forEach(script => script.remove());

            // Parse and make elements editable
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const page = doc.querySelector('div#page') || doc.body;
            if (page) {
                Array.from(page.children).forEach((child, i) => {
                    const compStyle = getComputedStyle(child);
                    child.style.position = 'absolute';
                    child.style.left = compStyle.left !== 'auto' ? compStyle.left : `${i * 20}px`;
                    child.style.top = compStyle.top !== 'auto' ? compStyle.top : `${i * 20}px`;
                    child.style.width = compStyle.width !== 'auto' ? compStyle.width : '100px';
                    child.style.height = compStyle.height !== 'auto' ? compStyle.height : '50px';
                    if (child.tagName === 'IMG' || child.tagName === 'VIDEO' || child.tagName === 'AUDIO' || child.tagName === 'IFRAME' || child.tagName === 'PICTURE') {
                        child.src = child.src || '';
                    }
                    if (child.tagName === 'INPUT' || child.tagName === 'TEXTAREA') {
                        child.placeholder = child.placeholder || '';
                    }
                    if (child.tagName === 'A' || child.tagName === 'BUTTON') {
                        child.href = child.href || '';
                    }
                    workspace.appendChild(child);
                    attachEventListeners(child);
                    resizeObserver.observe(child);
                });
            }
            const style = document.createElement('style');
            style.setAttribute('data-dynamic', 'true');
            style.textContent = css;
            document.head.appendChild(style);
            try {
                const script = document.createElement('script');
                script.setAttribute('data-dynamic', 'true');
                script.textContent = js;
                document.body.appendChild(script);
            } catch (e) {
                console.error('Error executing JS:', e);
            }
            savePageState(currentPage);
            updateCode();
        }

        // Update code function
        function updateCode() {
            let html = '<div id="page">\n';
            let css = '#page {\n  position: relative;\n}\n';
            let js = '// Dynamic JS for interactions\n';
            const children = Array.from(workspace.children).filter(el => el.id !== 'previewFrame');
            let hasForm = false;
            let hasButton = false;
            let hasLink = false;

            children.forEach((el, i) => {
                const uniqueClass = `elem${i + 1}`;
                el.dataset.uniqueClass = uniqueClass;
                if (!el.classList.contains(uniqueClass)) {
                    el.classList.add(uniqueClass);
                }

                const clone = el.cloneNode(true);
                if (mode === 'edit') {
                    clone.style.position = '';
                    clone.style.left = '';
                    clone.style.top = '';
                }
                clone.classList.remove('selected');
                if (clone.tagName === 'BUTTON') {
                    clone.textContent = el.textContent;
                }
                if (clone.tagName === 'IMG' || clone.tagName === 'VIDEO' || clone.tagName === 'AUDIO' || clone.tagName === 'IFRAME' || clone.tagName === 'PICTURE') {
                    clone.src = el.src || '';
                }
                if (clone.tagName === 'INPUT' || clone.tagName === 'TEXTAREA') {
                    clone.placeholder = el.placeholder || '';
                }
                if (clone.tagName === 'A' || clone.tagName === 'BUTTON') {
                    clone.href = el.href || '';
                    if (el.dataset.pageLink) {
                        clone.dataset.pageLink = el.dataset.pageLink;
                    }
                }
                html += `  ${clone.outerHTML}\n`;

                const compStyle = getComputedStyle(el);
                css += `.${uniqueClass} {\n`;
                const props = ['position', 'left', 'top', 'width', 'height', 'background-color', 'border', 'border-radius', 'border-width', 'border-color', 'border-style', 'color', 'font-size', 'font-family', 'display', 'padding', 'margin', 'z-index'];
                props.forEach(prop => {
                    const value = compStyle.getPropertyValue(prop);
                    if (value && value !== 'auto' && value !== '0px' && value !== 'rgba(0, 0, 0, 0)') {
                        css += `  ${prop}: ${value};\n`;
                    }
                });
                if (el.className.includes('triangle')) {
                    css += `  border-left: ${compStyle.borderLeft};\n`;
                    css += `  border-right: ${compStyle.borderRight};\n`;
                    css += `  border-bottom: ${compStyle.borderBottom};\n`;
                }
                css += '}\n';

                if (el.tagName === 'FORM') hasForm = true;
                if (el.tagName === 'BUTTON' || el.className.includes('button')) hasButton = true;
                if (el.querySelectorAll('a').length > 0 || el.tagName === 'A') hasLink = true;
            });
            html += '</div>';

            if (hasForm) {
                js += `document.querySelector('form').addEventListener('submit', (e) => {\n  e.preventDefault();\n  console.log('Form submitted');\n});\n`;
            }
            if (hasButton) {
                js += `document.querySelectorAll('button').forEach(btn => {\n  btn.addEventListener('click', () => {\n    if (btn.dataset.pageLink) {\n      // Page navigation handled by designer\n    } else {\n      console.log('Button clicked');\n    }\n  });\n});\n`;
            }
            if (hasLink) {
                js += `document.querySelectorAll('a').forEach(a => {\n  a.addEventListener('click', (e) => {\n    e.preventDefault();\n    if (a.dataset.pageLink) {\n      // Page navigation handled by designer\n    } else {\n      console.log('Link clicked: ' + a.href);\n    }\n  });\n});\n`;
            }

            htmlArea.value = html;
            cssArea.value = css;
            jsArea.value = js || '// No JS generated yet';

            pages[currentPage].html = html;
            pages[currentPage].css = css;
            pages[currentPage].js = js;
            if (mode === 'view') updatePreview();
        }

        // Initialize
        setMode('edit');
        [htmlArea, cssArea, jsArea].forEach(input => input.addEventListener('input', () => {
            if (mode === 'view') updatePreview();
        }));
    </script>
</body>
</html>
