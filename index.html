<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Web Designer Tool</title>
    <style>
        body {
            background-color: #1e1e1e;
            color: #ffffff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        #container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        #top-menu {
            background-color: #2d2d2d;
            padding: 10px;
            border-radius: 4px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        #top-menu button {
            background-color: #3c3c3c;
            border: none;
            color: #fff;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
        }
        #top-menu button:hover {
            background-color: #4a4a4a;
        }
        #top-menu button.active {
            background-color: #007bff;
        }
        #main-content {
            display: flex;
            flex-direction: row;
            gap: 20px;
        }
        #menu {
            width: 250px;
            background-color: #2d2d2d;
            padding: 20px;
            border-right: 1px solid #444;
            max-height: 600px;
            overflow-y: auto;
        }
        #properties {
            width: 250px;
            background-color: #2d2d2d;
            padding: 20px;
            border-left: 1px solid #444;
            max-height: 600px;
            overflow-y: auto;
        }
        details {
            margin-bottom: 10px;
        }
        summary {
            cursor: pointer;
            background-color: #3c3c3c;
            padding: 10px;
            border-radius: 4px;
        }
        #menu ul {
            list-style: none;
            padding: 0;
            margin: 10px 0 0 0;
        }
        #menu li {
            padding: 10px;
            background-color: #3c3c3c;
            margin-bottom: 5px;
            cursor: grab;
            border-radius: 4px;
            user-select: none;
        }
        #menu li:hover {
            background-color: #4a4a4a;
        }
        #workspace {
            flex: 1;
            height: 600px;
            background-color: #333;
            border: 1px solid #444;
            position: relative;
            overflow: auto;
            transition: width 0.3s;
        }
        #code {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
        #code textarea {
            width: 32%;
            height: 300px;
            background-color: #2d2d2d;
            color: #ffffff;
            border: 1px solid #444;
            padding: 10px;
            font-family: monospace;
            resize: vertical;
        }
        #properties label {
            display: block;
            margin-bottom: 10px;
        }
        #properties input, #properties select, #properties textarea {
            background-color: #2d2d2d;
            color: #fff;
            border: 1px solid #444;
            width: 100%;
            padding: 5px;
        }
        .shape.rectangle, .shape.square {
            background-color: #007bff;
        }
        .shape.circle, .shape.oval {
            background-color: #dc3545;
            border-radius: 50%;
        }
        .shape.triangle {
            width: 0;
            height: 0;
            border-left: 50px solid transparent;
            border-right: 50px solid transparent;
            border-bottom: 100px solid #28a745;
            background-color: transparent;
        }
        .icon, .social-icon {
            font-size: 24px;
            display: inline-block;
        }
        #workspace > * {
            resize: both;
            overflow: auto;
        }
        #workspace.view-mode > * {
            resize: none;
            cursor: default;
        }
        #workspace.view-mode > *.selected {
            border: none;
        }
        #workspace.phone {
            width: 375px;
            margin: 0 auto;
        }
        #workspace.tablet {
            width: 768px;
            margin: 0 auto;
        }
        #workspace.laptop {
            width: 1024px;
            margin: 0 auto;
        }
        #page-nav {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        #page-nav input, #page-nav select, #page-nav button {
            background-color: #3c3c3c;
            border: none;
            color: #fff;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
        }
        #page-nav input:hover, #page-nav select:hover, #page-nav button:hover {
            background-color: #4a4a4a;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="top-menu">
            <button id="edit-mode-btn" class="active" onclick="setMode('edit')">Edit Mode</button>
            <button id="view-mode-btn" onclick="setMode('view')">View Mode</button>
            <button id="phone-btn" onclick="setPreview('phone')" style="display: none;">Phone</button>
            <button id="tablet-btn" onclick="setPreview('tablet')" style="display: none;">Tablet</button>
            <button id="laptop-btn" onclick="setPreview('laptop')" style="display: none;">Laptop</button>
            <button id="add-shape-btn" onclick="openCategory('shapes')">Add Shape</button>
            <button id="add-icon-btn" onclick="openCategory('icons')">Add Icon</button>
            <button id="add-social-icon-btn" onclick="openCategory('social-icons')">Add Social Icon</button>
            <button id="add-navigation-btn" onclick="openCategory('navigations')">Add Navigation</button>
            <button id="add-menu-btn" onclick="openCategory('menus')">Add Menu</button>
            <button id="add-media-btn" onclick="openCategory('media')">Add Media</button>
            <button id="add-form-btn" onclick="openCategory('forms')">Add Form</button>
            <button id="add-utility-btn" onclick="openCategory('utilities')">Add Utility</button>
            <button id="add-creative-btn" onclick="openCategory('creatives')">Add Creative</button>
        </div>
        <div id="page-nav">
            <button onclick="newPage()">New Page</button>
            <input id="page-name" type="text" placeholder="Enter page name" value="index.html">
            <select id="page-selector" onchange="switchPage(this.value)">
                <option value="page1" data-name="index.html">index.html</option>
            </select>
        </div>
        <div id="main-content">
            <div id="menu">
                <details id="shapes">
                    <summary>Shapes</summary>
                    <ul>
                        <li draggable="true" data-type="div" data-class="shape rectangle" data-width="100" data-height="50">Rectangle</li>
                        <li draggable="true" data-type="div" data-class="shape square" data-width="100" data-height="100">Square</li>
                        <li draggable="true" data-type="div" data-class="shape circle" data-width="50" data-height="50">Circle</li>
                        <li draggable="true" data-type="div" data-class="shape oval" data-width="100" data-height="50">Oval</li>
                        <li draggable="true" data-type="div" data-class="shape triangle" data-width="100" data-height="100">Triangle</li>
                        <li draggable="true" data-type="div" data-class="shape pentagon" data-width="100" data-height="100">Pentagon</li>
                        <li draggable="true" data-type="div" data-class="shape hexagon" data-width="100" data-height="100">Hexagon</li>
                        <li draggable="true" data-type="div" data-class="shape star" data-width="100" data-height="100">Star</li>
                        <li draggable="true" data-type="div" data-class="shape trapezoid" data-width="100" data-height="50">Trapezoid</li>
                        <li draggable="true" data-type="div" data-class="shape diamond" data-width="100" data-height="100">Diamond</li>
                    </ul>
                </details>
                <details id="icons">
                    <summary>Icons</summary>
                    <ul>
                        <li draggable="true" data-type="span" data-class="icon smiley" data-content="😊" data-width="30" data-height="30">Smiley</li>
                        <li draggable="true" data-type="span" data-class="icon heart" data-content="❤️" data-width="30" data-height="30">Heart</li>
                        <li draggable="true" data-type="span" data-class="icon star" data-content="⭐" data-width="30" data-height="30">Star</li>
                        <li draggable="true" data-type="span" data-class="icon check" data-content="✅" data-width="30" data-height="30">Check</li>
                        <li draggable="true" data-type="span" data-class="icon thumbsup" data-content="👍" data-width="30" data-height="30">Thumbs Up</li>
                        <li draggable="true" data-type="span" data-class="icon fire" data-content="🔥" data-width="30" data-height="30">Fire</li>
                        <li draggable="true" data-type="span" data-class="icon globe" data-content="🌍" data-width="30" data-height="30">Globe</li>
                        <li draggable="true" data-type="span" data-class="icon clock" data-content="⏰" data-width="30" data-height="30">Clock</li>
                        <li draggable="true" data-type="span" data-class="icon email" data-content="✉️" data-width="30" data-height="30">Email</li>
                        <li draggable="true" data-type="span" data-class="icon phone" data-content="📞" data-width="30" data-height="30">Phone</li>
                        <li draggable="true" data-type="span" data-class="icon user" data-content="👤" data-width="30" data-height="30">User</li>
                        <li draggable="true" data-type="span" data-class="icon home" data-content="🏠" data-width="30" data-height="30">Home</li>
                    </ul>
                </details>
                <details id="social-icons">
                    <summary>Social Icons</summary>
                    <ul>
                        <li draggable="true" data-type="a" data-class="social-icon facebook" data-content="📘" data-width="30" data-height="30">Facebook</li>
                        <li draggable="true" data-type="a" data-class="social-icon twitter" data-content="🐦" data-width="30" data-height="30">Twitter</li>
                        <li draggable="true" data-type="a" data-class="social-icon instagram" data-content="📸" data-width="30" data-height="30">Instagram</li>
                        <li draggable="true" data-type="a" data-class="social-icon linkedin" data-content="💼" data-width="30" data-height="30">LinkedIn</li>
                        <li draggable="true" data-type="a" data-class="social-icon github" data-content="🐙" data-width="30" data-height="30">GitHub</li>
                        <li draggable="true" data-type="a" data-class="social-icon youtube" data-content="▶️" data-width="30" data-height="30">YouTube</li>
                        <li draggable="true" data-type="a" data-class="social-icon tiktok" data-content="🎵" data-width="30" data-height="30">TikTok</li>
                        <li draggable="true" data-type="a" data-class="social-icon discord" data-content="🎮" data-width="30" data-height="30">Discord</li>
                    </ul>
                </details>
                <details id="navigations">
                    <summary>Navigations</summary>
                    <ul>
                        <li draggable="true" data-type="nav" data-class="navigation bar" data-content='<ul><li><a href="#">Home</a></li><li><a href="#">About</a></li><li><a href="#">Contact</a></li></ul>' data-width="400" data-height="40">Horizontal Nav Bar</li>
                        <li draggable="true" data-type="nav" data-class="navigation sidebar" data-content='<ul><li><a href="#">Home</a></li><li><a href="#">About</a></li><li><a href="#">Contact</a></li></ul>' data-width="150" data-height="200">Vertical Sidebar</li>
                        <li draggable="true" data-type="footer" data-class="navigation footer" data-content='<p>Footer Content</p>' data-width="400" data-height="50">Footer Nav</li>
                        <li draggable="true" data-type="header" data-class="navigation header" data-content='<h1>Header</h1>' data-width="400" data-height="50">Header Nav</li>
                        <li draggable="true" data-type="nav" data-class="navigation breadcrumb" data-content='<ul><li><a href="#">Home</a></li><li><a href="#">Category</a></li><li><a href="#">Page</a></li></ul>' data-width="400" data-height="30">Breadcrumb</li>
                    </ul>
                </details>
                <details id="menus">
                    <summary>Menus</summary>
                    <ul>
                        <li draggable="true" data-type="select" data-class="menu dropdown" data-content='<option>Option 1</option><option>Option 2</option><option>Option 3</option>' data-width="150" data-height="30">Dropdown Menu</li>
                        <li draggable="true" data-type="ul" data-class="menu list" data-content='<li>Item 1</li><li>Item 2</li><li>Item 3</li>' data-width="150" data-height="100">List Menu</li>
                        <li draggable="true" data-type="input" data-class="menu radio" data-input-type="radio" data-name="group1" data-width="30" data-height="30">Radio Button</li>
                        <li draggable="true" data-type="input" data-class="menu checkbox" data-input-type="checkbox" data-width="30" data-height="30">Checkbox</li>
                        <li draggable="true" data-type="select" data-class="menu multiselect" data-content='<option>Option 1</option><option>Option 2</option><option>Option 3</option>' data-width="150" data-height="100">Multi-Select</li>
                    </ul>
                </details>
                <details id="media">
                    <summary>Media</summary>
                    <ul>
                        <li draggable="true" data-type="img" data-class="media image" data-width="150" data-height="150">Image</li>
                        <li draggable="true" data-type="video" data-class="media video" data-width="320" data-height="240">Video</li>
                        <li draggable="true" data-type="audio" data-class="media audio" data-width="200" data-height="30">Audio</li>
                        <li draggable="true" data-type="iframe" data-class="media iframe" data-width="300" data-height="200">Iframe</li>
                        <li draggable="true" data-type="picture" data-class="media picture" data-width="150" data-height="150">Picture</li>
                    </ul>
                </details>
                <details id="forms">
                    <summary>Forms</summary>
                    <ul>
                        <li draggable="true" data-type="form" data-class="form container" data-content='<input type="text" placeholder="Name"><input type="email" placeholder="Email"><button>Submit</button>' data-width="300" data-height="150">Basic Form</li>
                        <li draggable="true" data-type="input" data-class="form text" data-input-type="text" data-placeholder="Enter text" data-width="200" data-height="30">Text Input</li>
                        <li draggable="true" data-type="input" data-class="form email" data-input-type="email" data-placeholder="Enter email" data-width="200" data-height="30">Email Input</li>
                        <li draggable="true" data-type="input" data-class="form password" data-input-type="password" data-placeholder="Enter password" data-width="200" data-height="30">Password Input</li>
                        <li draggable="true" data-type="textarea" data-class="form textarea" data-placeholder="Enter message" data-width="200" data-height="100">Textarea</li>
                        <li draggable="true" data-type="button" data-class="form button" data-content="Submit" data-width="100" data-height="30">Button</li>
                        <li draggable="true" data-type="input" data-class="form file" data-input-type="file" data-width="200" data-height="30">File Upload</li>
                        <li draggable="true" data-type="input" data-class="form number" data-input-type="number" data-placeholder="Enter number" data-width="200" data-height="30">Number Input</li>
                        <li draggable="true" data-type="input" data-class="form date" data-input-type="date" data-width="200" data-height="30">Date Input</li>
                    </ul>
                </details>
                <details id="utilities">
                    <summary>Utilities</summary>
                    <ul>
                        <li draggable="true" data-type="div" data-class="utility container" data-width="200" data-height="100">Container Div</li>
                        <li draggable="true" data-type="section" data-class="utility section" data-width="300" data-height="150">Section</li>
                        <li draggable="true" data-type="article" data-class="utility article" data-width="300" data-height="150">Article</li>
                        <li draggable="true" data-type="aside" data-class="utility aside" data-width="150" data-height="200">Aside</li>
                        <li draggable="true" data-type="p" data-class="utility paragraph" data-content="Paragraph text" data-width="200" data-height="50">Paragraph</li>
                        <li draggable="true" data-type="div" data-class="utility card" data-width="200" data-height="150">Card</li>
                        <li draggable="true" data-type="hr" data-class="utility divider" data-width="200" data-height="2">Divider</li>
                    </ul>
                </details>
                <details id="creatives">
                    <summary>Creatives</summary>
                    <ul>
                        <li draggable="true" data-type="canvas" data-class="creative canvas" data-width="200" data-height="200">Canvas</li>
                        <li draggable="true" data-type="svg" data-class="creative svg" data-content='<rect width="100" height="50" fill="blue"/>' data-width="200" data-height="200">SVG</li>
                        <li draggable="true" data-type="div" data-class="creative animation" data-width="100" data-height="100">Animation Box</li>
                        <li draggable="true" data-type="div" data-class="creative carousel" data-width="300" data-height="200">Carousel</li>
                    </ul>
                </details>
            </div>
            <div id="workspace" class="edit-mode"></div>
            <div id="properties">
                <h3>Properties</h3>
                <div id="prop-content"></div>
                <button id="delete-btn" style="display: none; background-color: #dc3545; border: none; color: white; padding: 10px; cursor: pointer;">Delete Selected</button>
            </div>
        </div>
    </div>
    <div id="code">
        <textarea id="html" placeholder="Generated HTML"></textarea>
        <textarea id="css" placeholder="Generated CSS"></textarea>
        <textarea id="js" placeholder="Generated JS">// No JS generated yet</textarea>
    </div>

    <script>
        const workspace = document.getElementById('workspace');
        const htmlArea = document.getElementById('html');
        const cssArea = document.getElementById('css');
        const jsArea = document.getElementById('js');
        const propContent = document.getElementById('prop-content');
        const deleteBtn = document.getElementById('delete-btn');
        const editModeBtn = document.getElementById('edit-mode-btn');
        const viewModeBtn = document.getElementById('view-mode-btn');
        const phoneBtn = document.getElementById('phone-btn');
        const tabletBtn = document.getElementById('tablet-btn');
        const laptopBtn = document.getElementById('laptop-btn');
        const addShapeBtn = document.getElementById('add-shape-btn');
        const addIconBtn = document.getElementById('add-icon-btn');
        const addSocialIconBtn = document.getElementById('add-social-icon-btn');
        const addNavigationBtn = document.getElementById('add-navigation-btn');
        const addMenuBtn = document.getElementById('add-menu-btn');
        const addMediaBtn = document.getElementById('add-media-btn');
        const addFormBtn = document.getElementById('add-form-btn');
        const addUtilityBtn = document.getElementById('add-utility-btn');
        const addCreativeBtn = document.getElementById('add-creative-btn');
        const pageSelector = document.getElementById('page-selector');
        const pageNameInput = document.getElementById('page-name');

        let dragging = null;
        let offsetX = 0;
        let offsetY = 0;
        let selected = null;
        let mode = 'edit';
        let currentPage = 'page1';
        let pages = { 'page1': { name: 'index.html', html: '', css: '', js: '', elements: [] } };
        let pageCount = 1;
        const resizeObserver = new ResizeObserver(() => updateCode());

        // Mode switching
        function setMode(newMode) {
            mode = newMode;
            workspace.classList.remove('edit-mode', 'view-mode');
            workspace.classList.add(`${mode}-mode`);
            editModeBtn.classList.toggle('active', mode === 'edit');
            viewModeBtn.classList.toggle('active', mode === 'view');
            phoneBtn.style.display = mode === 'view' ? 'inline-block' : 'none';
            tabletBtn.style.display = mode === 'view' ? 'inline-block' : 'none';
            laptopBtn.style.display = mode === 'view' ? 'inline-block' : 'none';
            addShapeBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';
            addIconBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';
            addSocialIconBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';
            addNavigationBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';
            addMenuBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';
            addMediaBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';
            addFormBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';
            addUtilityBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';
            addCreativeBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';
            document.getElementById('menu').style.display = mode === 'edit' ? 'block' : 'none';
            document.getElementById('properties').style.display = mode === 'edit' ? 'block' : 'none';
            if (mode === 'view') {
                if (selected) {
                    selected.style.border = '';
                    selected.classList.remove('selected');
                }
                selected = null;
                propContent.innerHTML = '';
                deleteBtn.style.display = 'none';
                document.querySelectorAll('#menu li').forEach(item => item.setAttribute('draggable', 'false'));
                document.getElementById('menu').style.pointerEvents = 'none';
                setPreview('laptop'); // Default to laptop view
            } else {
                document.querySelectorAll('#menu li').forEach(item => item.setAttribute('draggable', 'true'));
                document.getElementById('menu').style.pointerEvents = 'auto';
                workspace.classList.remove('phone', 'tablet', 'laptop');
                workspace.style.width = '';
                workspace.style.margin = '';
            }
            updateCode();
        }

        // Preview mode
        function setPreview(device) {
            if (mode !== 'view') return;
            workspace.classList.remove('phone', 'tablet', 'laptop');
            workspace.classList.add(device);
            phoneBtn.classList.toggle('active', device === 'phone');
            tabletBtn.classList.toggle('active', device === 'tablet');
            laptopBtn.classList.toggle('active', device === 'laptop');
        }

        // Save page state
        function savePageState(pageId) {
            pages[pageId].elements = Array.from(workspace.children).map(el => {
                const clone = el.cloneNode(true);
                const styles = { ...el.style };
                const attributes = {};
                Array.from(el.attributes).forEach(attr => {
                    if (attr.name !== 'style' && attr.name !== 'class') {
                        attributes[attr.name] = attr.value;
                    }
                });
                return {
                    element: clone,
                    style: styles,
                    attributes: attributes,
                    innerHTML: el.innerHTML,
                    textContent: el.textContent,
                    classList: Array.from(el.classList)
                };
            });
            pages[pageId].html = htmlArea.value;
            pages[pageId].css = cssArea.value;
            pages[pageId].js = jsArea.value;
            pages[pageId].name = pageNameInput.value;
        }

        // Page management
        function newPage() {
            savePageState(currentPage);
            pageCount++;
            const newPageId = `page${pageCount}`;
            const pageName = `page${pageCount}.html`;
            pages[newPageId] = { name: pageName, html: '', css: '', js: '', elements: [] };
            const option = document.createElement('option');
            option.value = newPageId;
            option.textContent = pageName;
            option.dataset.name = pageName;
            pageSelector.appendChild(option);
            switchPage(newPageId);
            pageNameInput.value = pageName;
        }

        function switchPage(pageId) {
            if (pageId === currentPage) return;
            // Save current page state
            savePageState(currentPage);
            // Update selector text
            pageSelector.querySelector(`option[value="${currentPage}"]`).textContent = pageNameInput.value;
            pageSelector.querySelector(`option[value="${currentPage}"]`).dataset.name = pageNameInput.value;

            // Switch to new page
            currentPage = pageId;
            workspace.innerHTML = '';
            pages[pageId].elements.forEach(({ element, style, attributes, innerHTML, textContent, classList }) => {
                const newEl = element.cloneNode(false);
                newEl.innerHTML = innerHTML;
                newEl.textContent = textContent;
                newEl.className = classList.join(' ');
                Object.assign(newEl.style, style);
                Object.entries(attributes).forEach(([name, value]) => {
                    newEl.setAttribute(name, value);
                });
                workspace.appendChild(newEl);
                if (newEl.tagName === 'FORM') {
                    newEl.addEventListener('submit', (ev) => {
                        ev.preventDefault();
                        console.log('Form submitted:', new FormData(newEl));
                        alert('Form submitted! Check console for data.');
                    });
                }
                if (newEl.tagName === 'BUTTON' || newEl.className.includes('button')) {
                    newEl.addEventListener('click', () => {
                        if (mode === 'view' && newEl.dataset.pageLink) {
                            switchPage(newEl.dataset.pageLink);
                            setMode('view');
                        } else if (mode === 'view') {
                            console.log('Button clicked!');
                            alert('Button clicked!');
                        }
                    });
                }
                if (newEl.querySelectorAll('a').length > 0 || newEl.tagName === 'A') {
                    if (newEl.tagName === 'A') {
                        newEl.addEventListener('click', (ev) => {
                            if (mode === 'view') {
                                ev.preventDefault();
                                if (newEl.dataset.pageLink) {
                                    switchPage(newEl.dataset.pageLink);
                                    setMode('view');
                                } else {
                                    console.log('Link clicked:', newEl.href);
                                    alert(`Link clicked: ${newEl.href}`);
                                }
                            }
                        });
                    } else {
                        newEl.querySelectorAll('a').forEach(a => {
                            a.addEventListener('click', (ev) => {
                                if (mode === 'view') {
                                    ev.preventDefault();
                                    if (a.dataset.pageLink) {
                                        switchPage(a.dataset.pageLink);
                                        setMode('view');
                                    } else {
                                        console.log('Link clicked:', a.href);
                                        alert(`Link clicked: ${a.href}`);
                                    }
                                }
                            });
                        });
                    }
                }
                resizeObserver.observe(newEl);
            });
            htmlArea.value = pages[pageId].html || '';
            cssArea.value = pages[pageId].css || '';
            jsArea.value = pages[pageId].js || '// No JS generated yet';
            pageSelector.value = pageId;
            pageNameInput.value = pages[pageId].name;
            if (selected) {
                selected.style.border = '';
                selected.classList.remove('selected');
                selected = null;
                propContent.innerHTML = '';
                deleteBtn.style.display = 'none';
            }
        }

        // Update page name
        pageNameInput.addEventListener('input', () => {
            pages[currentPage].name = pageNameInput.value;
            pageSelector.querySelector(`option[value="${currentPage}"]`).textContent = pageNameInput.value;
            pageSelector.querySelector(`option[value="${currentPage}"]`).dataset.name = pageNameInput.value;
        });

        // Open specific category
        function openCategory(categoryId) {
            document.querySelectorAll('#menu details').forEach(detail => {
                detail.removeAttribute('open');
            });
            document.getElementById(categoryId).setAttribute('open', '');
        }

        // Drag from menu to workspace
        workspace.addEventListener('dragover', (e) => {
            if (mode === 'edit') e.preventDefault();
        });
        workspace.addEventListener('drop', (e) => {
            if (mode !== 'edit') return;
            e.preventDefault();
            const type = e.dataTransfer.getData('type');
            const className = e.dataTransfer.getData('class');
            const content = e.dataTransfer.getData('content');
            const width = e.dataTransfer.getData('width');
            const height = e.dataTransfer.getData('height');
            const inputType = e.dataTransfer.getData('input-type');
            const placeholder = e.dataTransfer.getData('placeholder');
            const name = e.dataTransfer.getData('name');

            const elem = document.createElement(type);
            elem.className = className;
            elem.style.position = 'absolute';
            elem.style.left = `${e.offsetX - (width / 2)}px`;
            elem.style.top = `${e.offsetY - (height / 2)}px`;
            elem.style.width = `${width}px`;
            elem.style.height = `${height}px`;

            if (content) elem.innerHTML = content;
            if (inputType) elem.type = inputType;
            if (placeholder) elem.placeholder = placeholder;
            if (name) elem.name = name;

            // Apply base styles based on class
            if (className.includes('circle') || className.includes('oval')) {
                elem.style.borderRadius = '50%';
            }
            if (className.includes('rectangle') || className.includes('square') || className.includes('container') || className.includes('card')) {
                elem.style.backgroundColor = '#444';
                elem.style.border = '1px solid #666';
            }
            if (className.includes('triangle')) {
                elem.style.width = '0';
                elem.style.height = '0';
                elem.style.borderLeft = '50px solid transparent';
                elem.style.borderRight = '50px solid transparent';
                elem.style.borderBottom = '100px solid #28a745';
                elem.style.backgroundColor = 'transparent';
                elem.style.resize = 'none';
            }
            if (className.includes('icon') || className.includes('social-icon')) {
                elem.style.display = 'inline-block';
            }
            if (type === 'button') {
                elem.textContent = content || 'Button';
            }
            if (type === 'video' || type === 'audio') {
                elem.controls = true;
                elem.src = '';
            }
            if (type === 'img' || type === 'iframe' || type === 'picture') {
                elem.src = '';
            }
            if (type === 'form') {
                elem.addEventListener('submit', (ev) => {
                    ev.preventDefault();
                    console.log('Form submitted:', new FormData(elem));
                    alert('Form submitted! Check console for data.');
                });
            }
            if (type === 'button' || className.includes('button')) {
                elem.addEventListener('click', () => {
                    if (mode === 'view' && elem.dataset.pageLink) {
                        switchPage(elem.dataset.pageLink);
                        setMode('view');
                    } else if (mode === 'view') {
                        console.log('Button clicked!');
                        alert('Button clicked!');
                    }
                });
            }
            if (elem.querySelectorAll('a').length > 0 || type === 'a') {
                if (type === 'a') {
                    elem.href = '';
                    elem.addEventListener('click', (ev) => {
                        if (mode === 'view') {
                            ev.preventDefault();
                            if (elem.dataset.pageLink) {
                                switchPage(elem.dataset.pageLink);
                                setMode('view');
                            } else {
                                console.log('Link clicked:', elem.href);
                                alert(`Link clicked: ${elem.href}`);
                            }
                        }
                    });
                } else {
                    elem.querySelectorAll('a').forEach(a => {
                        a.href = a.href || '';
                        a.addEventListener('click', (ev) => {
                            if (mode === 'view') {
                                ev.preventDefault();
                                if (a.dataset.pageLink) {
                                    switchPage(a.dataset.pageLink);
                                    setMode('view');
                                } else {
                                    console.log('Link clicked:', a.href);
                                    alert(`Link clicked: ${a.href}`);
                                }
                            }
                        });
                    });
                }
            }

            workspace.appendChild(elem);
            resizeObserver.observe(elem);
            savePageState(currentPage);
            updateCode();
        });

        // Menu item drag start
        const menuItems = document.querySelectorAll('#menu li');
        menuItems.forEach(item => {
            item.addEventListener('dragstart', (e) => {
                if (mode !== 'edit') return;
                e.dataTransfer.setData('type', item.dataset.type);
                e.dataTransfer.setData('class', item.dataset.class);
                e.dataTransfer.setData('content', item.dataset.content || '');
                e.dataTransfer.setData('width', item.dataset.width || '100');
                e.dataTransfer.setData('height', item.dataset.height || '50');
                e.dataTransfer.setData('input-type', item.dataset.inputType || '');
                e.dataTransfer.setData('placeholder', item.dataset.placeholder || '');
                e.dataTransfer.setData('name', item.dataset.name || '');
            });
        });

        // Dragging elements within workspace
        workspace.addEventListener('mousedown', (e) => {
            if (mode !== 'edit') return;
            if (e.target !== workspace && e.target.parentElement === workspace) {
                dragging = e.target;
                const rect = workspace.getBoundingClientRect();
                offsetX = e.clientX - rect.left - parseFloat(dragging.style.left || 0);
                offsetY = e.clientY - rect.top - parseFloat(dragging.style.top || 0);
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (mode !== 'edit' || !dragging) return;
            const rect = workspace.getBoundingClientRect();
            dragging.style.left = `${e.clientX - rect.left - offsetX}px`;
            dragging.style.top = `${e.clientY - rect.top - offsetY}px`;
        });

        document.addEventListener('mouseup', () => {
            if (dragging) {
                savePageState(currentPage);
                updateCode();
                dragging = null;
            }
        });

        // Selection for properties
        workspace.addEventListener('click', (e) => {
            if (mode !== 'edit') return;
            if (selected) {
                selected.style.border = '';
                selected.classList.remove('selected');
            }
            if (e.target === workspace) {
                selected = null;
                propContent.innerHTML = '';
                deleteBtn.style.display = 'none';
            } else {
                selected = e.target;
                selected.style.border = '1px dashed white';
                selected.classList.add('selected');
                showProperties();
                deleteBtn.style.display = 'block';
            }
            e.stopPropagation();
        });

        // Delete button
        deleteBtn.addEventListener('click', () => {
            if (mode !== 'edit' || !selected) return;
            resizeObserver.unobserve(selected);
            selected.remove();
            selected = null;
            propContent.innerHTML = '';
            deleteBtn.style.display = 'none';
            savePageState(currentPage);
            updateCode();
        });

        // Keyboard delete
        document.addEventListener('keydown', (e) => {
            if (mode !== 'edit' || e.key !== 'Delete' || !selected) return;
            resizeObserver.unobserve(selected);
            selected.remove();
            selected = null;
            propContent.innerHTML = '';
            deleteBtn.style.display = 'none';
            savePageState(currentPage);
            updateCode();
        });

        function showProperties() {
            if (!selected) return;
            const compStyle = getComputedStyle(selected);
            const width = parseInt(selected.style.width) || parseInt(compStyle.width);
            const height = parseInt(selected.style.height) || parseInt(compStyle.height);
            const left = parseInt(selected.style.left) || 0;
            const top = parseInt(selected.style.top) || 0;
            const bgColor = rgbToHex(compStyle.backgroundColor);
            const textColor = rgbToHex(compStyle.color);
            const fontSize = parseInt(compStyle.fontSize) || 16;
            const borderRadius = compStyle.borderRadius || '0px';
            const borderWidth = compStyle.borderWidth || '0px';
            const borderColor = rgbToHex(compStyle.borderColor);
            const borderStyle = compStyle.borderStyle || 'none';
            const contentEditable = selected.tagName === 'P' || selected.tagName === 'SPAN' || selected.tagName === 'BUTTON' || selected.className.includes('paragraph');
            const isMedia = selected.tagName === 'IMG' || selected.tagName === 'VIDEO' || selected.tagName === 'AUDIO' || selected.tagName === 'IFRAME' || selected.tagName === 'PICTURE';
            const isLink = selected.tagName === 'A' || selected.tagName === 'BUTTON' || selected.className.includes('button');
            const isInput = selected.tagName === 'INPUT' || selected.tagName === 'TEXTAREA';
            const isNav = selected.className.includes('navigation');

            let content = `
                <label>Left: <input type="number" id="prop-left" value="${left}"></label>
                <label>Top: <input type="number" id="prop-top" value="${top}"></label>
                <label>Width: <input type="number" id="prop-width" value="${width}"></label>
                <label>Height: <input type="number" id="prop-height" value="${height}"></label>
                <label>Background Color: <input type="color" id="prop-bgcolor" value="${bgColor}"></label>
                <label>Text Color: <input type="color" id="prop-color" value="${textColor}"></label>
                <label>Font Size: <input type="number" id="prop-fontsize" value="${fontSize}"></label>
                <label>Border Radius: <input type="text" id="prop-borderradius" value="${borderRadius}"></label>
                <label>Border Width: <input type="text" id="prop-borderwidth" value="${borderWidth}"></label>
                <label>Border Color: <input type="color" id="prop-bordercolor" value="${borderColor}"></label>
                <label>Border Style: <select id="prop-borderstyle">
                    <option value="none" ${borderStyle === 'none' ? 'selected' : ''}>None</option>
                    <option value="solid" ${borderStyle === 'solid' ? 'selected' : ''}>Solid</option>
                    <option value="dashed" ${borderStyle === 'dashed' ? 'selected' : ''}>Dashed</option>
                    <option value="dotted" ${borderStyle === 'dotted' ? 'selected' : ''}>Dotted</option>
                </select></label>
            `;

            if (contentEditable) {
                content += `<label>Text: <input type="text" id="prop-text" value="${selected.textContent.trim()}"></label>`;
            }
            if (isMedia) {
                content += `<label>Source URL: <input type="text" id="prop-src" value="${selected.src || ''}"></label>`;
            }
            if (isLink) {
                content += `<label>External Link URL: <input type="text" id="prop-href" value="${selected.href || ''}"></label>`;
                content += `<label>Link to Page: <select id="prop-page-link"><option value="">None</option>`;
                Object.keys(pages).forEach(pageId => {
                    content += `<option value="${pageId}" ${selected.dataset.pageLink === pageId ? 'selected' : ''}>${pages[pageId].name}</option>`;
                });
                content += `</select></label>`;
            }
            if (isInput) {
                content += `<label>Placeholder: <input type="text" id="prop-placeholder" value="${selected.placeholder || ''}"></label>`;
            }
            if (isNav) {
                const items = Array.from(selected.querySelectorAll('li')).map(li => li.innerHTML).join('\n');
                content += `<label>Nav Items: <textarea id="prop-navitems">${items}</textarea></label>`;
            }

            propContent.innerHTML = content;

            // Event listeners for properties
            document.getElementById('prop-left').addEventListener('input', (e) => {
                selected.style.left = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-top').addEventListener('input', (e) => {
                selected.style.top = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-width').addEventListener('input', (e) => {
                selected.style.width = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-height').addEventListener('input', (e) => {
                selected.style.height = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-bgcolor').addEventListener('input', (e) => {
                selected.style.backgroundColor = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-color').addEventListener('input', (e) => {
                selected.style.color = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-fontsize').addEventListener('input', (e) => {
                selected.style.fontSize = e.target.value + 'px';
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-borderradius').addEventListener('input', (e) => {
                selected.style.borderRadius = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-borderwidth').addEventListener('input', (e) => {
                selected.style.borderWidth = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-bordercolor').addEventListener('input', (e) => {
                selected.style.borderColor = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            document.getElementById('prop-borderstyle').addEventListener('change', (e) => {
                selected.style.borderStyle = e.target.value;
                savePageState(currentPage);
                updateCode();
            });
            if (contentEditable) {
                document.getElementById('prop-text').addEventListener('input', (e) => {
                    selected.textContent = e.target.value;
                    savePageState(currentPage);
                    updateCode();
                });
            }
            if (isMedia) {
                document.getElementById('prop-src').addEventListener('input', (e) => {
                    selected.src = e.target.value;
                    savePageState(currentPage);
                    updateCode();
                });
            }
            if (isLink) {
                document.getElementById('prop-href').addEventListener('input', (e) => {
                    selected.href = e.target.value;
                    savePageState(currentPage);
                    updateCode();
                });
                document.getElementById('prop-page-link').addEventListener('change', (e) => {
                    if (e.target.value) {
                        selected.dataset.pageLink = e.target.value;
                        selected.href = '#';
                    } else {
                        delete selected.dataset.pageLink;
                        selected.href = document.getElementById('prop-href').value || '';
                    }
                    savePageState(currentPage);
                    updateCode();
                });
            }
            if (isInput) {
                document.getElementById('prop-placeholder').addEventListener('input', (e) => {
                    selected.placeholder = e.target.value;
                    savePageState(currentPage);
                    updateCode();
                });
            }
            if (isNav) {
                document.getElementById('prop-navitems').addEventListener('input', (e) => {
                    selected.innerHTML = e.target.value;
                    selected.querySelectorAll('a').forEach(a => {
                        a.addEventListener('click', (ev) => {
                            if (mode === 'view') {
                                ev.preventDefault();
                                if (a.dataset.pageLink) {
                                    switchPage(a.dataset.pageLink);
                                    setMode('view');
                                } else {
                                    console.log('Link clicked:', a.href);
                                    alert(`Link clicked: ${a.href}`);
                                }
                            }
                        });
                    });
                    savePageState(currentPage);
                    updateCode();
                });
            }
        }

        function rgbToHex(rgb) {
            if (!rgb || rgb === 'rgba(0, 0, 0, 0)') return '#000000';
            const [r, g, b] = rgb.match(/\d+/g).map(Number);
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
        }

        // Update code function
        function updateCode() {
            let html = '<div id="page">\n';
            let css = '#page {\n  position: relative;\n}\n';
            let js = '// Dynamic JS for interactions\n';
            const children = Array.from(workspace.children);
            let hasForm = false;
            let hasButton = false;
            let hasLink = false;

            children.forEach((el, i) => {
                const uniqueClass = `elem${i + 1}`;
                el.dataset.uniqueClass = uniqueClass;
                if (!el.classList.contains(uniqueClass)) {
                    el.classList.add(uniqueClass);
                }

                const clone = el.cloneNode(true);
                clone.removeAttribute('style');
                clone.classList.remove('selected');
                if (clone.tagName === 'BUTTON') {
                    clone.textContent = el.textContent;
                }
                if (clone.tagName === 'IMG' || clone.tagName === 'VIDEO' || clone.tagName === 'AUDIO' || clone.tagName === 'IFRAME' || clone.tagName === 'PICTURE') {
                    clone.src = el.src || '';
                }
                if (clone.tagName === 'INPUT' || clone.tagName === 'TEXTAREA') {
                    clone.placeholder = el.placeholder || '';
                }
                if (clone.tagName === 'A' || clone.tagName === 'BUTTON') {
                    clone.href = el.href || '';
                    if (el.dataset.pageLink) {
                        clone.dataset.pageLink = el.dataset.pageLink;
                    }
                }
                html += `  ${clone.outerHTML}\n`;

                const compStyle = getComputedStyle(el);
                css += `.${uniqueClass} {\n`;
                const props = ['position', 'left', 'top', 'width', 'height', 'background-color', 'border', 'border-radius', 'border-width', 'border-color', 'border-style', 'color', 'font-size', 'display', 'padding', 'margin'];
                props.forEach(prop => {
                    const value = compStyle.getPropertyValue(prop);
                    if (value && value !== 'auto' && value !== '0px' && value !== 'rgba(0, 0, 0, 0)') {
                        css += `  ${prop}: ${value};\n`;
                    }
                });
                if (el.className.includes('triangle')) {
                    css += `  border-left: ${compStyle.borderLeft};\n`;
                    css += `  border-right: ${compStyle.borderRight};\n`;
                    css += `  border-bottom: ${compStyle.borderBottom};\n`;
                }
                css += '}\n';

                // Check for interactions
                if (el.tagName === 'FORM') hasForm = true;
                if (el.tagName === 'BUTTON' || el.className.includes('button')) hasButton = true;
                if (el.querySelectorAll('a').length > 0 || el.tagName === 'A') hasLink = true;
            });
            html += '</div>';

            // Generate JS for interactions
            if (hasForm) {
                js += `document.querySelector('form').addEventListener('submit', (e) => {\n  e.preventDefault();\n  console.log('Form submitted');\n});\n`;
            }
            if (hasButton) {
                js += `document.querySelectorAll('button').forEach(btn => {\n  btn.addEventListener('click', () => {\n    if (btn.dataset.pageLink) {\n      // Page navigation handled by designer\n    } else {\n      console.log('Button clicked');\n    }\n  });\n});\n`;
            }
            if (hasLink) {
                js += `document.querySelectorAll('a').forEach(a => {\n  a.addEventListener('click', (e) => {\n    e.preventDefault();\n    if (a.dataset.pageLink) {\n      // Page navigation handled by designer\n    } else {\n      console.log('Link clicked: ' + a.href);\n    }\n  });\n});\n`;
            }

            htmlArea.value = html;
            cssArea.value = css;
            jsArea.value = js || '// No JS generated yet';

            // Save to current page
            pages[currentPage].html = html;
            pages[currentPage].css = css;
            pages[currentPage].js = js;
        }

        // Initialize edit mode
        setMode('edit');
    </script>
</body>
</html>
